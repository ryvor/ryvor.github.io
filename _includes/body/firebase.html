<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
  import {	getAuth,
            signInWithPopup, GithubAuthProvider,
            sendSignInLinkToEmail, isSignInWithEmailLink, signInWithEmailLink,
            signInWithPhoneNumber } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-analytics.js";

  const app = initializeApp({
    apiKey: "AIzaSyCZYhv-k9hgHEZGWPq1XuMFDlXGBfY934g",
    authDomain: "ryvor-portfolio.firebaseapp.com",
    projectId: "ryvor-portfolio",
    storageBucket: "ryvor-portfolio.appspot.com",
    messagingSenderId: "354876397984",
    appId: "1:354876397984:web:c98964abbe972b6a756cc5",
    measurementId: "G-PZ7S7SC9SD"
  });
  const analytics = getAnalytics(app);
  const auth = getAuth();
  /*
  if (isSignInWithEmailLink(window.location.href)) {
    var email = window.localStorage.getItem("emailForSignIn");
    if (!email) {
      email = window.prompt("Please provide your email for confirmation");
    }
    signInWithEmailLink(email, window.location.href).then(function (result) {
      window.localStorage.removeItem("emailForSignIn");
      console.log("User signed in:", result.user);
    }).catch(function (error) {
      alert("An error occurred while trying to log you in");
      console.error("Sign-in error:", error);
    });
  };
  */
  window.account = {
    Login: {
      github: () => {
        const provider = new GithubAuthProvider();
        signInWithPopup(auth, provider).then((result) => {
          const credential = GithubAuthProvider.credentialFromResult(result);
          const token = credential.accessToken;
          const user = result.user;
        }).catch((error) => {
          const errorCode = error.code;
          const errorMessage = error.message;
          const email = error.customData.email;
          const credential = GithubAuthProvider.credentialFromError(error);
        });
      },
      email: (email, actionCodeSettings = { url: "https://ryvor.github.io/finishSignUp", handleCodeInApp: true }) => {
        sendSignInLinkToEmail(auth, email, actionCodeSettings).then(function () {
          window.localStorage.setItem("emailForSignIn", email);
          console.log("Email sent");
        }).catch(function (error) {
          var errorCode = error.code;
          var errorMessage = error.message;
          console.error("Email sending error:", errorCode, errorMessage);
        });
      },
      phone: (phoneNumber = getPhoneNumberFromUserInput(), appVerifier = window.recaptchaVerifier) => {
        /* TODO: PHONE AUTHENTICATION
          signInWithPhoneNumber(auth, phoneNumber, appVerifier).then((confirmationResult) => {
            window.confirmationResult = confirmationResult;
          }).catch((error) => {
            window.recaptchaVerifier.render().then(function(widgetId) {
              grecaptcha.reset(widgetId);
            });
          });
        */
      }
    },
    Logout: () => {
      signOut().then(() => {
        alert('Logout successful')
      }).catch((error) => {
        var errorCode = error.code;
        var errorMessage = error.message;
        console.error("Logout error:", errorCode, errorMessage);
      });
    }
  }
</script>